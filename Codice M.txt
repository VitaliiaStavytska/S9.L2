
Tabella Ordini


let
    Origine = Excel.Workbook(File.Contents("C:\Users\vital\Downloads\M3S1E2 (1).xlsx"), null, true),
    Ordini_Sheet = Origine{[Item="Ordini",Kind="Sheet"]}[Data],
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(Ordini_Sheet, [PromoteAllScalars=true]),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse prime righe" = Table.Skip(#"Modificato tipo",2),
    #"Intestazioni alzate di livello1" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Modificato tipo1" = Table.TransformColumnTypes(#"Intestazioni alzate di livello1",{{"COD PROD", type text}, {"Column2", type any}, {"Column3", type any}, {"Collaboratore", type text}, {"Regione", type text}, {"Column6", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Column9", type any}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Rimosse colonne" = Table.RemoveColumns(#"Modificato tipo1",{"Column2", "Column3", "Column9"}),
    #"Testo troncato" = Table.TransformColumns(#"Rimosse colonne",{{"Prodotto", Text.Trim, type text}}),
    #"Filtrate righe" = Table.SelectRows(#"Testo troncato", each true),
    #"Testo troncato1" = Table.TransformColumns(#"Filtrate righe",{{"Regione", Text.Trim, type text}}),
    #"Rinominate colonne" = Table.RenameColumns(#"Testo troncato1",{{"Column6", "Data"}}),
    #"Testo troncato2" = Table.TransformColumns(#"Rinominate colonne",{{"Collaboratore", Text.Trim, type text}}),
    #"Pulito testo" = Table.TransformColumns(#"Testo troncato2",{{"Collaboratore", Text.Clean, type text}}),
    #"Pulito testo1" = Table.TransformColumns(#"Pulito testo",{{"Collaboratore", Text.Clean, type text}}),
    #"Testo troncato3" = Table.TransformColumns(#"Pulito testo1",{{"Collaboratore", Text.Trim, type text}}),
    #"Pulito testo2" = Table.TransformColumns(#"Testo troncato3",{{"Collaboratore", Text.Clean, type text}}),
    #"Sostituito valore" = Table.ReplaceValue(#"Pulito testo2"," ","_",Replacer.ReplaceText,{"Collaboratore"}),
    #"Sostituito valore1" = Table.ReplaceValue(#"Sostituito valore",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Filtrate righe1" = Table.SelectRows(#"Sostituito valore1", each true),
    #"Sostituito valore2" = Table.ReplaceValue(#"Filtrate righe1","_"," ",Replacer.ReplaceText,{"Collaboratore"}),
    #"Filtrate righe2" = Table.SelectRows(#"Sostituito valore2", each true),
    #"Sostituito valore3" = Table.ReplaceValue(#"Filtrate righe2","Emilia.Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Filtrate righe3" = Table.SelectRows(#"Sostituito valore3", each true),
    #"Sostituito valore4" = Table.ReplaceValue(#"Filtrate righe3","Emilia-Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Filtrate righe4" = Table.SelectRows(#"Sostituito valore4", each true),
    #"Testo troncato4" = Table.TransformColumns(#"Filtrate righe4",{{"Categoria", Text.Trim, type text}}),
    #"Filtrate righe5" = Table.SelectRows(#"Testo troncato4", each true),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Filtrate righe5", "Totale", each [Prezzo unitario]*[Quantità]),
    #"Rinominate colonne1" = Table.RenameColumns(#"Aggiunta colonna personalizzata",{{"Data", "Data Ordine"}}),
    #"Ordinate righe" = Table.Sort(#"Rinominate colonne1",{{"Collaboratore", Order.Descending}}),
    #"Pulito testo3" = Table.TransformColumns(#"Ordinate righe",{{"COD PROD", Text.Clean, type text}, {"Collaboratore", Text.Clean, type text}, {"Regione", Text.Clean, type text}}),
    #"Sostituito valore5" = Table.ReplaceValue(#"Pulito testo3"," ","",Replacer.ReplaceText,{"Collaboratore", "Regione", "Categoria", "Prodotto"}),
    #"Sostituito valore6" = Table.ReplaceValue(#"Sostituito valore5"," ","",Replacer.ReplaceText,{"COD PROD"}),
    #"Aggiunta colonna indice" = Table.AddIndexColumn(#"Sostituito valore6", "Indice", 0, 1, Int64.Type),
    #"Rimosse colonne1" = Table.RemoveColumns(#"Aggiunta colonna indice",{"Indice"}),
    #"Caratteri finali inseriti" = Table.AddColumn(#"Rimosse colonne1", "Caratteri finali", each Text.End([COD PROD], 4), type text),
    #"Rinominate colonne2" = Table.RenameColumns(#"Caratteri finali inseriti",{{"Caratteri finali", "Cifre"}}),
    #"Modificato tipo2" = Table.TransformColumnTypes(#"Rinominate colonne2",{{"Cifre", Int64.Type}}),
    #"Ordinate righe1" = Table.Sort(#"Modificato tipo2",{{"Collaboratore", Order.Ascending}}),
    #"Filtrate righe6" = Table.SelectRows(#"Ordinate righe1", each ([Collaboratore] <> "FoveAnna")),
    #"Duplicata colonna" = Table.DuplicateColumn(#"Filtrate righe6", "Totale", "Totale - Copia"),
    #"Inserita moltiplicazione" = Table.AddColumn(#"Duplicata colonna", "Moltiplicazione", each [#"Totale - Copia"] * 0.22, type number),
    #"Modificato tipo3" = Table.TransformColumnTypes(#"Inserita moltiplicazione",{{"Moltiplicazione", Currency.Type}, {"Totale", Currency.Type}, {"Quantità", Int64.Type}, {"Prezzo unitario", Currency.Type}}),
    #"Rimosse colonne2" = Table.RemoveColumns(#"Modificato tipo3",{"Totale - Copia"}),
    #"Rinominate colonne3" = Table.RenameColumns(#"Rimosse colonne2",{{"Moltiplicazione", "IVA"}}),
    #"Inserita colonna combinata" = Table.AddColumn(#"Rinominate colonne3", "CATPROD", each Text.Combine({[Categoria], [Prodotto]}, " "), type text),
    #"Colonna condizionale aggiunta" = Table.AddColumn(#"Inserita colonna combinata", "SE", each if [Quantità] < 20 then "TROVATO" else null),
    #"Rimosse colonne3" = Table.RemoveColumns(#"Colonna condizionale aggiunta",{"SE"}),
    #"Colonna condizionale aggiunta1" = Table.AddColumn(#"Rimosse colonne3", "Personalizzato", each if [Quantità] > 20 then "TROVATO" else null),
    #"Rimosse colonne4" = Table.RemoveColumns(#"Colonna condizionale aggiunta1",{"Personalizzato"}),
    #"Colonna condizionale aggiunta2" = Table.AddColumn(#"Rimosse colonne4", "SE", each if [Quantità] > 20 then "TROVATO" else "NON TROVATO"),
    #"filtro le righe :))))" = Table.SelectRows(#"Colonna condizionale aggiunta2", each true),
    #"trasformo le regioni in maiuscolo" = Table.TransformColumns(#"filtro le righe :))))",{{"Regione", Text.Upper, type text}}),
    #"Colonna condizionale aggiunta3" = Table.AddColumn(#"trasformo le regioni in maiuscolo", "SE2", each if [Data Ordine] > #date(2003, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2003, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2004, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2004, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2005, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2005, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2005, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2006, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2006, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2007, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2007, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2008, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2008, 4, 1) then "DOPO DELL'APRILE" else if [Data Ordine] < #date(2009, 4, 1) then "PRIMA DELL'APRILE" else if [Data Ordine] > #date(2009, 4, 1) then "DOPO DELL'APRILE" else null),
    #"Filtrate righe7" = Table.SelectRows(#"Colonna condizionale aggiunta3", each true),
    #"Dividi colonna per passaggio carattere" = Table.SplitColumn(#"Filtrate righe7", "COD PROD", Splitter.SplitTextByCharacterTransition((c) => not List.Contains({"0".."9"}, c), {"0".."9"}), {"COD PROD.1", "COD PROD.2"}),
    #"Rinominate colonne4" = Table.RenameColumns(#"Dividi colonna per passaggio carattere",{{"Collaboratore", "COLLABORATORI"}})
in
    #"Rinominate colonne4"


Tabella SECONDA

let
    Origine = Excel.Workbook(File.Contents("C:\Users\vital\Downloads\M3S1E2 (1).xlsx"), null, true),
    Ordini_Sheet = Origine{[Item="Ordini",Kind="Sheet"]}[Data],
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(Ordini_Sheet, [PromoteAllScalars=true]),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse prime righe" = Table.Skip(#"Modificato tipo",2),
    #"Intestazioni alzate di livello1" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Modificato tipo1" = Table.TransformColumnTypes(#"Intestazioni alzate di livello1",{{"COD PROD", type text}, {"Column2", type any}, {"Column3", type any}, {"Collaboratore", type text}, {"Regione", type text}, {"Column6", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Column9", type any}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Rimosse colonne" = Table.RemoveColumns(#"Modificato tipo1",{"Column2", "Column3", "Column9"}),
    #"Testo troncato" = Table.TransformColumns(#"Rimosse colonne",{{"Prodotto", Text.Trim, type text}}),
    #"Filtrate righe" = Table.SelectRows(#"Testo troncato", each true),
    #"Testo troncato1" = Table.TransformColumns(#"Filtrate righe",{{"Regione", Text.Trim, type text}}),
    #"Rinominate colonne" = Table.RenameColumns(#"Testo troncato1",{{"Column6", "Data"}}),
    #"Testo troncato2" = Table.TransformColumns(#"Rinominate colonne",{{"Collaboratore", Text.Trim, type text}}),
    #"Pulito testo" = Table.TransformColumns(#"Testo troncato2",{{"Collaboratore", Text.Clean, type text}}),
    #"Pulito testo1" = Table.TransformColumns(#"Pulito testo",{{"Collaboratore", Text.Clean, type text}}),
    #"Testo troncato3" = Table.TransformColumns(#"Pulito testo1",{{"Collaboratore", Text.Trim, type text}}),
    #"Pulito testo2" = Table.TransformColumns(#"Testo troncato3",{{"Collaboratore", Text.Clean, type text}}),
    #"Sostituito valore" = Table.ReplaceValue(#"Pulito testo2"," ","_",Replacer.ReplaceText,{"Collaboratore"}),
    #"Sostituito valore1" = Table.ReplaceValue(#"Sostituito valore",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Filtrate righe1" = Table.SelectRows(#"Sostituito valore1", each true),
    #"Sostituito valore2" = Table.ReplaceValue(#"Filtrate righe1","_"," ",Replacer.ReplaceText,{"Collaboratore"}),
    #"Filtrate righe2" = Table.SelectRows(#"Sostituito valore2", each true),
    #"Sostituito valore3" = Table.ReplaceValue(#"Filtrate righe2","Emilia.Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Filtrate righe3" = Table.SelectRows(#"Sostituito valore3", each true),
    #"Sostituito valore4" = Table.ReplaceValue(#"Filtrate righe3","Emilia-Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Filtrate righe4" = Table.SelectRows(#"Sostituito valore4", each true),
    #"Testo troncato4" = Table.TransformColumns(#"Filtrate righe4",{{"Categoria", Text.Trim, type text}}),
    #"Filtrate righe5" = Table.SelectRows(#"Testo troncato4", each true),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Filtrate righe5", "Totale", each [Prezzo unitario]*[Quantità]),
    #"Rinominate colonne1" = Table.RenameColumns(#"Aggiunta colonna personalizzata",{{"Data", "Data Ordine"}}),
    #"Ordinate righe" = Table.Sort(#"Rinominate colonne1",{{"Collaboratore", Order.Descending}}),
    #"Pulito testo3" = Table.TransformColumns(#"Ordinate righe",{{"COD PROD", Text.Clean, type text}, {"Collaboratore", Text.Clean, type text}, {"Regione", Text.Clean, type text}}),
    #"Sostituito valore5" = Table.ReplaceValue(#"Pulito testo3"," ","",Replacer.ReplaceText,{"Collaboratore", "Regione", "Categoria", "Prodotto"}),
    #"Sostituito valore6" = Table.ReplaceValue(#"Sostituito valore5"," ","",Replacer.ReplaceText,{"COD PROD"}),
    #"Aggiunta colonna indice" = Table.AddIndexColumn(#"Sostituito valore6", "Indice", 0, 1, Int64.Type),
    #"Rimosse colonne1" = Table.RemoveColumns(#"Aggiunta colonna indice",{"Indice"}),
    #"Caratteri finali inseriti" = Table.AddColumn(#"Rimosse colonne1", "Caratteri finali", each Text.End([COD PROD], 4), type text),
    #"Rinominate colonne2" = Table.RenameColumns(#"Caratteri finali inseriti",{{"Caratteri finali", "Cifre"}}),
    #"Modificato tipo2" = Table.TransformColumnTypes(#"Rinominate colonne2",{{"Cifre", Int64.Type}}),
    #"Ordinate righe1" = Table.Sort(#"Modificato tipo2",{{"Collaboratore", Order.Ascending}}),
    #"Filtrate righe6" = Table.SelectRows(#"Ordinate righe1", each ([Collaboratore] <> "FoveAnna")),
    #"Duplicata colonna" = Table.DuplicateColumn(#"Filtrate righe6", "Totale", "Totale - Copia"),
    #"Inserita moltiplicazione" = Table.AddColumn(#"Duplicata colonna", "Moltiplicazione", each [#"Totale - Copia"] * 0.22, type number),
    #"Modificato tipo3" = Table.TransformColumnTypes(#"Inserita moltiplicazione",{{"Moltiplicazione", Currency.Type}, {"Totale", Currency.Type}, {"Quantità", Int64.Type}, {"Prezzo unitario", Currency.Type}}),
    #"Rimosse colonne2" = Table.RemoveColumns(#"Modificato tipo3",{"Totale - Copia"}),
    #"Rinominate colonne3" = Table.RenameColumns(#"Rimosse colonne2",{{"Moltiplicazione", "IVA"}}),
    #"Inserita colonna combinata" = Table.AddColumn(#"Rinominate colonne3", "CATPROD", each Text.Combine({[Categoria], [Prodotto]}, " "), type text),
    #"Colonna condizionale aggiunta" = Table.AddColumn(#"Inserita colonna combinata", "SE", each if [Quantità] < 20 then "TROVATO" else null),
    #"Rimosse colonne3" = Table.RemoveColumns(#"Colonna condizionale aggiunta",{"SE"}),
    #"Colonna condizionale aggiunta1" = Table.AddColumn(#"Rimosse colonne3", "Personalizzato", each if [Quantità] > 20 then "TROVATO" else null),
    #"Rimosse colonne4" = Table.RemoveColumns(#"Colonna condizionale aggiunta1",{"Personalizzato"}),
    #"Colonna condizionale aggiunta2" = Table.AddColumn(#"Rimosse colonne4", "SE", each if [Quantità] > 20 then "TROVATO" else "NON TROVATO"),
    #"Filtrate righe7" = Table.SelectRows(#"Colonna condizionale aggiunta2", each true),
    #"Raggruppate righe" = Table.Group(#"Filtrate righe7", {"Collaboratore"}, {{"Conteggio quantità", each List.Sum([Quantità]), type nullable number}})
in
    #"Raggruppate righe"






